<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Donation Page</title>
<style>
  body { font-family: Arial; background-color: #e6f0ff; color: #003366; margin:0; padding:0; scroll-behavior:smooth; }
  header { background-color: #3366cc; padding: 20px; text-align: center; color:#fff; }
  header h1{margin:0; font-size:2em;}
  header p{margin:5px 0 0; font-style:italic;}
  .content { max-width:900px; margin:20px auto; padding:0 20px; }
  .book-info,.author-info{ margin-bottom:30px; }
  .book-info h2,.author-info h3{ color:#003366; }
  .donate-button{ display:block; width:250px; margin:20px auto; padding:15px; background-color:#003366; color:#fff; font-size:1.2em; text-align:center; text-decoration:none; border-radius:8px; cursor:pointer; transition:all 0.3s ease; }
  .donate-button:hover{ background-color:#2255aa; }
  .donation-section{ display:none; margin-top:20px; }
  .payment-methods{text-align:center; margin-bottom:20px;}
  .payment-methods button{ margin:5px; padding:10px 20px; font-size:1em; cursor:pointer; border-radius:6px; border:none; color:#fff; background-color:#3366cc; transition: all 0.3s ease; }
  .payment-methods button:hover{ background-color:#2255aa; }
  .wallet-container{text-align:center; margin-bottom:20px; position:relative; background-color:#cce0ff; padding:20px; border-radius:8px; word-break:break-word; max-width:350px; margin-left:auto; margin-right:auto;}
  .wallet-container img{ width:150px; height:150px; margin-bottom:10px;}
  .wallet-container p{ font-size:0.9em; margin:10px 0; word-break: break-all;}
  .copy-btn{ cursor:pointer; padding:6px 12px; background-color:#003366; color:#fff; border:none; border-radius:6px; font-size:0.8em; transition:all 0.3s ease; }
  .copy-btn.copied{ background-color:#2ecc71; transform:scale(1.05);}
  .donor-form{ max-width:400px; margin:0 auto; background-color:#cce0ff; padding:20px; border-radius:8px; }
  .donor-form label{ display:block; margin:10px 0 5px; }
  .donor-form input, .donor-form select{ width:100%; padding:8px; border-radius:6px; border:1px solid #003366; }
  .donor-form button{ margin-top:15px; padding:10px; width:100%; border:none; border-radius:6px; background-color:#003366; color:#fff; font-size:1em; cursor:pointer; transition:all 0.3s ease; }
  .donor-form button:hover{ background-color:#2255aa; }
  .confirmation{text-align:center; margin-top:20px; padding:10px; border-radius:6px; background-color:#d4f5d4; color:#006600; font-weight:bold; display:none; }
  .custom-alert{ display:none; background-color:#ffcccc; color:#990000; border-left:5px solid #cc0000; padding:10px; margin:10px 0; border-radius:5px; text-align:center;}
  #donor-list { max-height:300px; overflow-y:auto; margin-top:15px; padding-left:0; }
  #donor-list li { display:flex; justify-content:space-between; align-items:center; background-color:#cce0ff; margin:5px 0; padding:8px 12px; border-radius:6px; font-weight:bold; color:#003366; transition: opacity 0.5s ease; }
  .purpose-tag { padding:2px 6px; border-radius:4px; font-size:0.85em; color:#fff; margin-left:5px; }
  .Painting{ background-color:#ff66aa; }
  .Illustration{ background-color:#66ccff; }
  .Pre-copy{ background-color:#66ff99; }
  .Printing{ background-color:#ffcc66; }
  footer { text-align:center; margin-top:50px; padding:20px; background-color:#3366cc; color:#fff; }
  footer a { color:#fff; text-decoration:underline; }

  /* Quote styling */
  blockquote { font-family:'Georgia', serif; font-size:1.2em; color:#003366; max-width:700px; margin:20px auto; border-left:4px solid #3366cc; padding-left:15px; line-height:1.5; text-align:left; }
  blockquote small { font-family:Arial, sans-serif; font-size:0.9em; display:block; margin-top:5px; color:#003366; }
</style>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
<header>
  <h1>A Child Who Can Hear Feelingsüéß </h1>
  <p>A story for children with autism and learning challenges</p>
</header>

<div class="content">
  <section class="book-info">
    <h2>About the Book</h2>
    <p>This book is designed to help children understand emotions in a concrete way‚Äîturning feelings into sounds they can imagine. It‚Äôs especially meaningful for kids who experience the world differently, and it encourages empathy, emotional awareness, and kindness.</p>

    <!-- Inspiration Quote -->
    <blockquote>
      ‚ÄúImagination is more important than knowledge. For knowledge is limited, whereas imagination embraces the entire world.‚Äù ‚Äî Albert Einstein
      <small>As what inspired me to write this book.</small>
    </blockquote>
  </section>

  <section class="author-info">
    <h3>Author Autograph</h3>
    <p>Mar√≠a Lis Malter Terrada ‚Äî Argentine writer and children‚Äôs book author. Notable book: <i>Las Aventuras de Sammy</i>.</p>
    <img src="https://i.postimg.cc/CM8qxFgZ/7220d4c3fc1d73595fd3433f3650a917.jpg" alt="Author Picture"
         style="width:160px; height:auto; border-radius:10px; display:block; margin:15px auto 0;">
  </section>

  <a class="donate-button" id="show-donation">Donate Now</a>

  <div class="donation-section" id="donation-section">
    <div class="payment-methods">
      <p>Select your payment method:</p>
      <button onclick="showWallet('BTC')">Bitcoin (BTC)</button>
      <button onclick="showWallet('USDT')">USDT</button>
      <button onclick="showWallet('ETH')">Ethereum (ETH)</button>
      <button onclick="showWallet('USDC')">USDC (ETH)</button>
    </div>

    <div class="wallet-container" id="wallet-container"></div>

    <div class="donor-form">
      <label for="donor-name">Full Name:</label>
      <input type="text" id="donor-name" placeholder="Enter your full name" required>

      <label for="donor-email">Email:</label>
      <input type="email" id="donor-email" placeholder="Enter your email" required>

      <label for="donor-purpose">Donation Purpose:</label>
      <select id="donor-purpose" required>
        <option value="">Select what you‚Äôre donating for</option>
        <option value="Painting">Painting</option>
        <option value="Illustration">Illustration</option>
        <option value="Pre-copy">Pre-copy</option>
        <option value="Printing">Printing</option>
      </select>

      <label for="donor-amount">Amount (USD):</label>
      <input type="number" id="donor-amount" placeholder="Enter donation amount" required>

      <label for="donor-txid">Transaction ID:</label>
      <input type="text" id="donor-txid" placeholder="Enter your TXID" required>

      <button id="submit-btn" onclick="submitDonation()" disabled>Payment Made</button>
    </div>

    <div class="custom-alert" id="custom-alert">Please fill all fields before submitting.</div>

    <div class="confirmation" id="confirmation">
      <p>Thank you, <span id="conf-name"></span>! Your donation has been successfully received. üéâ</p>
      <p>Your support helps bring stories that inspire and educate children with autism. We truly appreciate your generosity!</p>
    </div>

    <div class="donor-list-section" style="margin-top:30px;">
      <h3>Our Supporters</h3>
      <ul id="donor-list"></ul>
    </div>
  </div>
</div>

<footer class="site-footer">
  <p><strong>Mar√≠a Lis Malter Terrada</strong></p>
  <p>Children‚Äôs Book Author</p>
  <p>üìß Contact: <a href="mailto:Lismalter97@gmail.com">Lismalter97@gmail.com</a></p>
  <p class="copyright">¬© <span id="year"></span> All rights reserved.</p>
</footer>

<script>
emailjs.init("JSsp83NL8OtnW52tk"); // Public Key
const ADMIN_PASSWORD = "MySecret123";
const JSON_BIN_ID = "696d60aeae596e708fe54df7";
const JSON_MASTER_KEY = "$2a$10$icad1llBzqjwwo7MDLB5Rud1ghIPyPI1roI9.m2rgN3nhhFuWnLBe";

const wallets = {
  BTC:{address:'bc1qpc5ahjnmvv62y50upf3nw4xc6k8t24yrjy9w8y', qr:'https://chart.googleapis.com/chart?cht=qr&chl=bc1qpc5ahjnmvv62y50upf3nw4xc6k8t24yrjy9w8y&chs=200x200'},
  USDT:{address:'TUYTBFzij5LUtwhgwrmC9MRWrKjLBA9N4G', qr:'https://chart.googleapis.com/chart?cht=qr&chl=TUYTBFzij5LUtwhgwrgwrmC9MRWrKjLBA9N4G&chs=200x200'},
  ETH:{address:'0x737F9370AAC907EefC8f7cC45ABb69cAE7273426', qr:'https://chart.googleapis.com/chart?cht=qr&chl=0x737F9370AAC907EefC8f7cC45ABb69cAE7273426&chs=200x200'},
  USDC:{address:'0x737F9370AAC907EefC8f7cC45ABb69cAE7273426', qr:'https://chart.googleapis.com/chart?cht=qr&chl=0x737F9370AAC907EefC8f7cC45ABb69cAE7273426&chs=200x200'}
};

document.getElementById('show-donation').addEventListener('click', ()=>{
  const section=document.getElementById('donation-section');
  section.style.display='block';
  section.scrollIntoView({behavior:'smooth'});
});

function showWallet(method){
  const container=document.getElementById('wallet-container');
  const wallet=wallets[method];
  container.innerHTML=`<img src="${wallet.qr}" alt="${method} QR">
  <p>${method} Wallet:<br>${wallet.address}</p>
  <button class="copy-btn" onclick="copyAddress('${wallet.address}',this)">Copy</button>`;
  document.getElementById('submit-btn').disabled=false;
}

function copyAddress(address,btn){
  navigator.clipboard.writeText(address).then(()=>{
    btn.innerText="Copied ‚úì";
    btn.classList.add("copied");
    setTimeout(()=>{btn.innerText="Copy"; btn.classList.remove("copied");},2000);
  });
}

// ===== GLOBAL DONORS =====
async function loadDonors(){
  const list=document.getElementById('donor-list'); 
  list.innerHTML='';
  try{
    const res=await fetch(`https://api.jsonbin.io/v3/b/${JSON_BIN_ID}/latest`,{
      headers:{'X-Master-Key':JSON_MASTER_KEY}
    });
    const data=await res.json();
    const donors=data.record.donors || [];

    // Pre-added supporters
    const preAdded = [
      {name:'Agustina Micaela', date:'5 January', purpose:'Painting'},
      {name:'John Smith', date:'28 December', purpose:'Illustration'},
      {name:'Maria Gonzalez', date:'2 January', purpose:'Pre-copy'},
      {name:'Liam Becker', date:'12 January', purpose:'Printing'},
      {name:'Ana Silva', date:'20 December', purpose:'Painting'}
    ];

    const allDonors = [...preAdded, ...donors];

    allDonors.forEach((donor,index)=>{
      const li=document.createElement('li');
      li.innerHTML=`<span>${donor.name} ‚Äî ${donor.date} <span class="purpose-tag ${donor.purpose}">${donor.purpose}</span></span>
                      <button class="remove-btn" onclick="removeDonor(${index}, this)">‚úñ</button>`;
      list.appendChild(li);
    });

  }catch(err){ console.error("Failed to load donors:",err);}
}

// REMOVE DONOR WITH FADE
async function removeDonor(index, btn){
  const input = prompt("Enter admin password to remove supporter:");
  if(input !== ADMIN_PASSWORD){ alert("Incorrect password."); return; }

  try {
    const res = await fetch(`https://api.jsonbin.io/v3/b/${JSON_BIN_ID}/latest`, {
      headers: { 'X-Master-Key': JSON_MASTER_KEY }
    });
    const data = await res.json();
    let donors = data.record.donors || [];

    // Adjust index because of pre-added donors
    if(index < 5){ // pre-added donors cannot be removed from JSONBin
      alert("Cannot remove pre-added supporter.");
      return;
    }
    donors.splice(index - 5, 1);

    await fetch(`https://api.jsonbin.io/v3/b/${JSON_BIN_ID}`, {
      method:'PUT',
      headers:{'Content-Type':'application/json','X-Master-Key':JSON_MASTER_KEY},
      body: JSON.stringify({ donors })
    });

    // Fade out effect
    const li = btn.parentElement;
    li.style.opacity = '0';
    setTimeout(()=>{ loadDonors(); }, 500);

    alert("Supporter removed successfully.");
  } catch(err){ console.error("Failed to remove donor:",err);}
}

// SUBMIT DONATION
async function submitDonation(){
  const name=document.getElementById('donor-name').value.trim();
  const email=document.getElementById('donor-email').value.trim();
  const amount=document.getElementById('donor-amount').value.trim();
  const txid=document.getElementById('donor-txid').value.trim();
  const purpose=document.getElementById('donor-purpose').value.trim();
  const walletSection=document.getElementById('wallet-container');
  if(!name||!email||!amount||!txid||!walletSection.innerHTML||!purpose){
    const alertBox=document.getElementById('custom-alert');
    alertBox.style.display='block';
    setTimeout(()=>{alertBox.style.display='none'},3000);
    return;
  }

  // Show confirmation
  document.getElementById('conf-name').innerText=name;
  const confirmation=document.getElementById('confirmation');
  confirmation.style.display='block';
  setTimeout(()=>{confirmation.style.display='none'},5000);

  // Add donor to JSONBin
  try{
    const res=await fetch(`https://api.jsonbin.io/v3/b/${JSON_BIN_ID}/latest`,{
      headers:{ 'X-Master-Key': JSON_MASTER_KEY }
    });
    const data=await res.json();
    const donors=data.record.donors||[];
    const now=new Date();
    const dateStr=now.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
    donors.push({name,purpose,date:dateStr});
    await fetch(`https://api.jsonbin.io/v3/b/${JSON_BIN_ID}`,{
      method:'PUT',
      headers:{ 'Content-Type':'application/json','X-Master-Key': JSON_MASTER_KEY },
      body: JSON.stringify({donors})
    });
    loadDonors();
  }catch(err){console.error("Failed to save donor:",err);}

  // Send Email
  emailjs.send("service_jhvdg4m","template_kkkt4ts",{
    name, amount, txid, purpose, email,
    method: walletSection.querySelector('p').innerText.split(' Wallet')[0]
  })
  .then(()=>{console.log("Email sent successfully");})
  .catch(err=>{console.error("Email failed:",err); alert("Email notification failed. Check your EmailJS setup.");});

  // Clear form
  document.getElementById('donor-name').value='';
  document.getElementById('donor-email').value='';
  document.getElementById('donor-amount').value='';
  document.getElementById('donor-txid').value='';
  document.getElementById('donor-purpose').value='';
}

loadDonors();
</script>
</body>
  </html>
